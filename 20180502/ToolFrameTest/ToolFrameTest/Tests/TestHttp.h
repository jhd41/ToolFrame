#pragma once

#include "ToolHttp.h"
#include "IHttpRequest.h"
#include "IHttpResponse.h"

const std::string g_sHttpTest1 = "GET /manager/game?callback=callback&OpCode=32779&UserID=3302&Token=347132488&Type=6&Flag=2&PrizeName=%E8%AF%B6&IconURL=http%3A%2F%2Fdtbfileserver.oss-cn-beijing.aliyuncs.com%2Ftu14903_10.jpg+&PrizeUnit=10&PrizeTotal=500&Brief=%E4%BA%8C&PrizeType=2&SerialNumber=100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C100000003%2C1000000";

bool TestHttpUrl(const std::string& sUrl) {
	IHttpRequest request;
	if (!request.InitWithUrl(sUrl))return false;
	request.SetConnection(true);
	std::string sFormated = request.ToFormat();
	IHttpRequest request1;
	if (!request1.InitWithFormat(sFormated))return false;
	if (!request1.IsConnection())return false;
	
	return true;
}

bool TestHttpFormat(const std::string& sFormat) {
	IHttpRequest request;
	if (!request.InitWithFormat(sFormat))return false;

	return true;
}

bool TestHttp() {
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/Alipay/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb="));
	ASSERT_LOG_ERROR(TestHttpUrl("hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb="));

	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/Alipay/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb="));
	ASSERT_LOG_ERROR(TestHttpUrl("http://hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb="));

	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/Alipay/creatorder.php"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb=2"));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/Alipay/creatorder.php?aaa=1&bb="));
	ASSERT_LOG_ERROR(TestHttpUrl("https://hypay.hao-games.com/Alipay/creatorder.php?aaa=&bb="));

	ASSERT_LOG_ERROR(!TestHttpFormat(g_sHttpTest1));

	IHttpResponse response;
	std::string ss1 = response.ToFormat();
	return true;
}
